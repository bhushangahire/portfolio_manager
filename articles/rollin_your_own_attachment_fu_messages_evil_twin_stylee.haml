-# title: Rollin your own attachment_fu messages evil twin stylee
-# published: 2007-12-03

:textile
  On the back of Patrick Crowley's "Roll your own attachment_fu validations":http://the.railsi.st/2007/11/27/roll-your-own-attachment_fu-validations I got off my butt and made a whole bunch of validations sexier... the result is this snippet/plugin/snippet, "evil twin stylee":http://errtheblog.com/post/19679, to give friendlier attachment validations.
  
  Use it like so:
  
  <pre><code class="ruby">
  class Photo < ActiveRecord::Base
    has_attachment :content_type => :image,
                   :max_size => 10.megabytes,
  
    validates_attachment :content_type => "The file you uploaded was not a JPEG, PNG or GIF",
                         :size         => "The image you uploaded was larger than the maximum size of 10MB"
  end
  </code></pre>
  
  Just chuck this into <code>vendor/plugins/attachment_fu_validates_attachment/init.rb</code>:
  
  <pre><code class="ruby">Technoweenie::AttachmentFu::InstanceMethods.module_eval do
    protected
      def attachment_valid?
        if self.filename.nil?
          errors.add_to_base attachment_validation_options[:empty]
          return
        end
        [:content_type, :size].each do |option|
          if attachment_validation_options[option] && attachment_options[option] && !attachment_options[option].include?(self.send(option))
            errors.add_to_base attachment_validation_options[option]
          end
        end
      end
  end
  
  Technoweenie::AttachmentFu::ClassMethods.module_eval do
    # Options: 
    # *  <tt>:empty</tt> - Base error message when no file is uploaded. Default is "No file uploaded"
    # *  <tt>:content_type</tt> - Base error message when the uploaded file is not a valid content type.
    # *  <tt>:size</tt> - Base error message when the uploaded file is not a valid size.
    #
    # Example:
    #   validates_attachment :content_type => "The file you uploaded was not a JPEG, PNG or GIF",
    #                        :size         => "The image you uploaded was larger than the maximum size of 10MB"
    def validates_attachment(options={})
      options[:empty] ||= "No file uploaded"
      class_inheritable_accessor :attachment_validation_options
      self.attachment_validation_options = options
      validate :attachment_valid?
    end
  end</code></pre>
  
  and say goodbye to errors messages like:
  
  * Content type can't be blank
  * Content type is not included in the list
  * Size can't be blank
  * Size is not included in the list
  * Filename can't be blank
  
  and say hello to:
  
  * No file uploaded
  
  and:
  
  * The file you uploaded was not a JPEG, PNG or GIF
  * The image you uploaded was larger than the maximum size of 10MB
